<!DOCTYPE html>
<html lang="es">
<head>
  <%- include("partials/head") %>
</head>
<body class="bg-gray-100 min-h-screen pb-10">

    <div class="bg-pattern pb-20 pt-8 px-6 rounded-b-[3rem] shadow-xl text-white relative">
        <div class="max-w-md mx-auto text-center">
            <p class="text-indigo-200 text-sm font-medium uppercase tracking-wider mb-1">Dinero Total en Caja</p>
            <h1 class="text-5xl font-extrabold mb-2">$<%= stats.caja.toLocaleString('es-CO') %></h1>
            
            <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-md px-4 py-1.5 rounded-full text-sm">
                <i class="fas fa-calendar-alt opacity-70"></i>
                <%= new Date(shift.startTime).toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' }) %>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto px-4 -mt-16 relative z-10 space-y-5">
        
        <div class="bg-white rounded-3xl shadow-lg p-5 border border-gray-100">
            <div class="grid grid-cols-3 gap-2 text-center divide-x divide-gray-100">
                <div>
                    <p class="text-[10px] text-gray-400 font-bold uppercase">Base</p>
                    <p class="font-bold text-gray-600">$<%= stats.base.toLocaleString('es-CO') %></p>
                </div>
                <div>
                    <p class="text-[10px] text-gray-400 font-bold uppercase">Ventas</p>
                    <p class="font-bold text-emerald-600">+$<%= stats.ventas.toLocaleString('es-CO') %></p>
                </div>
                <div>
                    <p class="text-[10px] text-gray-400 font-bold uppercase">Gastos</p>
                    <p class="font-bold text-red-500">-$<%= stats.gastos.toLocaleString('es-CO') %></p>
                </div>
            </div>
        </div>

        <div class="space-y-3">
            <h3 class="text-gray-500 font-bold text-sm ml-2 uppercase tracking-wider">Movimientos (<%= items.length %>)</h3>

            <% if (items.length === 0) { %>
                <div class="bg-white p-8 rounded-2xl text-center text-gray-400 shadow-sm">
                    <i class="fas fa-receipt text-3xl mb-2 opacity-30"></i>
                    <p class="text-sm">Caja iniciada. Sin movimientos.</p>
                </div>
            <% } %>

            <% items.forEach(item => { 
                const isExpense = item.type === 'expense';
                const isDelivery = item.invoiceNumber && item.invoiceNumber.toString().startsWith('CM');
                const isManual = item.invoiceNumber && item.invoiceNumber.toString().startsWith('MANUAL');
            %>
                <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 <%= isExpense ? 'border-red-500' : (isManual ? 'border-emerald-400' : 'border-indigo-500') %> flex justify-between items-center">
                    
                    <div class="flex items-center gap-3 overflow-hidden">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center shrink-0 
                            <%= isExpense ? 'bg-red-50 text-red-500' : 'bg-indigo-50 text-indigo-600' %>">
                            <i class="fas <%= isExpense ? 'fa-minus-circle' : (isManual ? 'fa-hand-holding-usd' : 'fa-motorcycle') %>"></i>
                        </div>
                        
                        <div class="min-w-0">
                            <p class="text-sm font-bold text-gray-800 truncate">
                                <%= isExpense ? item.description : isDelivery ? item.invoiceNumber : item.notes %>
                            </p>
                            <p class="text-xs text-gray-400 flex items-center gap-1">
                                <span><%= new Date(item.date).toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'}) %></span>
                                <% if (!isExpense) { %>
                                    • <span class="font-mono bg-gray-100 px-1 rounded text-[10px]">
                                        <%= isDelivery ? item.address.split(',')[0].trim() : isManual ? item.address : '#' + item.invoiceNumber %>
                                    </span>
                                <% } %>
                            </p>
                        </div>
                    </div>

                    <div class="text-right pl-2">
                        <span class="block font-bold text-sm <%= isExpense ? 'text-red-500' : 'text-emerald-600' %>">
                            <%= isExpense ? '-' : '+' %>$<%= item.amount.toLocaleString('es-CO') %>
                        </span>
                        <% if(item.notes) { %>
                            <i class="fas fa-sticky-note text-yellow-400 text-xs" title="<%= item.notes %>"></i>
                        <% } %>
                    </div>
                </div>
            <% }); %>
        </div>

        <div class="text-center pt-6 pb-4">
            <p class="text-xs text-gray-400">
                Generado por Delivery Tracker • by: MJFOOD
                </br>
                <span class="<%= shift.status === 'active' ? 'text-green-500 font-bold' : 'text-gray-500' %>">
                    <%= shift.status === 'active' ? '● En Vivo' : '● Finalizado' %>
                </span>
            </p>
        </div>
    </div>

</body>
</html>